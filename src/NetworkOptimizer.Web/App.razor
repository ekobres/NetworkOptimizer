@using Microsoft.AspNetCore.Components.Web
@using NetworkOptimizer.Web.Components
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
    <script>
        function downloadFile(fileName, contentType, base64Data) {
            const linkSource = `data:${contentType};base64,${base64Data}`;
            const downloadLink = document.createElement('a');
            downloadLink.href = linkSource;
            downloadLink.download = fileName;
            downloadLink.click();
        }

        // Tooltip click/tap handling for mobile and accessibility
        (function() {
            let activeTooltip = null;

            function closeActiveTooltip() {
                if (activeTooltip) {
                    activeTooltip.icon.classList.remove('active');
                    if (activeTooltip.content) {
                        activeTooltip.content.classList.remove('active');
                    }
                    activeTooltip = null;
                }
            }

            function toggleTooltip(icon) {
                const isActive = icon.classList.contains('active');

                // Close any other active tooltip
                closeActiveTooltip();

                // Toggle this one (if it wasn't already active)
                if (!isActive) {
                    icon.classList.add('active');

                    // For wrapper-style tooltips, also activate the content
                    const content = icon.nextElementSibling;
                    if (content && content.classList.contains('tooltip-content')) {
                        content.classList.add('active');
                        activeTooltip = { icon, content };
                    } else {
                        // data-tooltip style (no separate content element)
                        activeTooltip = { icon, content: null };
                    }
                }
            }

            // Handle clicks/taps on tooltip icons
            document.addEventListener('click', function(e) {
                const icon = e.target.closest('.tooltip-icon');
                if (icon) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleTooltip(icon);
                    return;
                }

                // If clicking inside tooltip content, don't close it
                if (e.target.closest('.tooltip-content')) {
                    return;
                }

                // Clicking elsewhere closes the active tooltip
                closeActiveTooltip();
            });

            // Close tooltip on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeActiveTooltip();
                }
            });

            // Re-initialize after Blazor updates the DOM
            if (typeof Blazor !== 'undefined') {
                Blazor.addEventListener('enhancedload', function() {
                    closeActiveTooltip();
                });
            }
        })();
    </script>
</body>

</html>
