# Network Optimizer Environment Configuration
# Copy this file to .env and update with your values

# ===== Network Binding =====
# BIND_LOCALHOST_ONLY: Controls which network interfaces the app listens on
#   - false (default): Binds to 0.0.0.0:8042 (accessible from network)
#   - true: Binds to 127.0.0.1:8042 (localhost only, use with reverse proxy on same host)
# BIND_LOCALHOST_ONLY=false

# ===== Timezone Configuration =====
# Common US timezones:
#   America/New_York (Eastern), America/Chicago (Central),
#   America/Denver (Mountain), America/Los_Angeles (Pacific)
# Other examples:
#   Europe/London, Europe/Paris, Asia/Tokyo, Australia/Sydney
TZ=America/New_York

# ===== Application Password =====
# Password precedence: Database (Settings UI) > APP_PASSWORD env var > Auto-generated
#
# On first run, an auto-generated password is shown in the logs.
# You can then set a permanent password in Settings > Admin Password (recommended).
# APP_PASSWORD is a fallback - useful for Docker deployments where you want
# to set the password before the first login.
# APP_PASSWORD=your_secure_password

# ===== Host Identity & Canonical URL Enforcement =====
# These settings identify the server for speed testing and optionally enforce a canonical URL.
# Redirects (302) only occur when HOST_NAME or REVERSE_PROXIED_HOST_NAME is set.
# HOST_IP alone does NOT trigger redirects (allows access via any hostname).

# HOST_IP: Server's IP address
#   - Used for: Speed test path analysis, CORS, OpenSpeedTest URL in UI
#   - Required for: Path analysis when server IP can't be auto-detected (bridge networking)
#   - Note: Does NOT enforce redirects (users can still access via hostname)
# HOST_IP=192.168.1.100

# HOST_NAME: Server's hostname (recommended for better UX)
#   - Used for: Canonical URL enforcement, user-facing URLs, OpenSpeedTest link in UI
#   - Requires: DNS resolution by clients (can be local DNS via router/Pi-hole)
#   - Examples: nas, server.local, optimizer.home.arpa
# HOST_NAME=nas

# REVERSE_PROXIED_HOST_NAME: Hostname when behind a reverse proxy
#   - Used for: Canonical URL (https, no port), API URL for OpenSpeedTest result reporting
#   - Set to: The hostname your reverse proxy serves (internal or public)
#   - Note: OpenSpeedTest container is still accessed via HOST_NAME/HOST_IP:3005
# REVERSE_PROXIED_HOST_NAME=optimizer.example.com

# ===== Client Speed Testing =====
# Browser-based: Speed Test runs on port 3005 (configurable), results auto-reported if HOST_IP/HOST_NAME set
#   To disable: comment out the network-optimizer-speedtest service in docker-compose.yml
# CLI-based: Enable iperf3 server mode for testing from devices with iperf3 installed

# Enable iperf3 server (listens on port 5201)
# IPERF3_SERVER_ENABLED=true

# OpenSpeedTest external port (default 3005)
#   - Used for: Docker port mapping, UI display, CORS, and host enforcement redirects
#   - Change if: Port 3005 conflicts with another service
# OPENSPEEDTEST_PORT=3005

# OpenSpeedTest hostname (defaults to HOST_NAME)
#   - Set if speedtest is accessed via a different hostname than the main app
#   - Example: speedtest.example.com when main app is at optimizer.example.com
# OPENSPEEDTEST_HOST=speedtest.example.com

# OpenSpeedTest HTTPS (when proxied through Caddy/nginx with TLS)
#   - Enables HTTPS CORS origins for speed test result reporting
#   - Required for browser geolocation to work (geolocation needs secure context)
#   - Set OPENSPEEDTEST_HTTPS=true when speedtest is behind a TLS-terminating proxy
# OPENSPEEDTEST_HTTPS=false
# OPENSPEEDTEST_HTTPS_PORT=443
#
# ⚠️  MIXED CONTENT WARNING:
#   If OPENSPEEDTEST_HTTPS=true, you MUST also set REVERSE_PROXIED_HOST_NAME.
#   Browsers block HTTP requests from HTTPS pages (mixed content).
#
#   Valid combinations:
#     ✅ Speedtest HTTP  + Main app HTTP  → Both use HOST_NAME/HOST_IP
#     ✅ Speedtest HTTP  + Main app HTTPS → Set REVERSE_PROXIED_HOST_NAME
#     ✅ Speedtest HTTPS + Main app HTTPS → Set both OPENSPEEDTEST_HTTPS and REVERSE_PROXIED_HOST_NAME
#     ❌ Speedtest HTTPS + Main app HTTP  → BLOCKED by browser (mixed content)
#
# IMPORTANT: Speedtest reverse proxies MUST force HTTP/1.1 for accurate results.
# HTTP/2+ multiplexing inflates speeds. However, HTTP/1.1 will BREAK the main
# Network Optimizer app (Blazor requires HTTP/2+ for WebSockets).
#
# If you want HTTPS for speedtest (required for geolocation), you need TWO
# separate proxy instances:
#   - speedtest.example.com → HTTP/1.1 → localhost:3005 (speedtest)
#   - optimizer.example.com → HTTP/2+  → localhost:8042 (main app)
#
# Geolocation lets you capture where on a property a test was run - useful for
# identifying Wi-Fi dead zones or verifying coverage in specific areas.
#
# Example Caddy config (separate Caddyfile or dedicated instance):
#
#   {
#       servers {
#           protocols h1
#       }
#   }
#
#   speedtest.local {
#       tls internal  # Remove for public certs
#
#       request_body {
#           max_size 35MB
#       }
#
#       reverse_proxy localhost:3005 {
#           request_buffers 35MiB
#           response_buffers 35MiB
#           flush_interval -1
#           header_up -Accept-Encoding
#       }
#   }

# ===== Advanced Settings =====
# Log levels: Trace, Debug, Information, Warning, Error, Critical
# LOG_LEVEL=Information       # General (framework, EF Core, etc.)
# APP_LOG_LEVEL=Debug         # Network Optimizer application

# Agent authentication token (auto-generated if not set)
# AGENT_AUTH_TOKEN=

# ===== Future: InfluxDB/Grafana (Not Yet Implemented) =====
# These settings are reserved for future time-series metrics support.
# Uncomment when the feature is available.

# INFLUXDB_PORT=8086
# INFLUXDB_USERNAME=admin
# INFLUXDB_PASSWORD=changeme_influxdb_password
# INFLUXDB_TOKEN=changeme_influxdb_token
# INFLUXDB_ORG=network-optimizer
# INFLUXDB_BUCKET=network_optimizer
# INFLUXDB_RETENTION=30d

# GRAFANA_PORT=3000
# GRAFANA_USERNAME=admin
# GRAFANA_PASSWORD=changeme_grafana_password
